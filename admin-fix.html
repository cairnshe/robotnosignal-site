<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fix Product IDs | Admin Tool</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      doc,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    import {
      getAuth,
      onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";

    // ‚úÖ ÊõøÊç¢‰∏∫‰Ω†ÁöÑ firebase-config.js ‰∏≠ÁöÑÈÖçÁΩÆ
    const firebaseConfig = {
      apiKey: "‰Ω†ÁöÑ apiKey",
      authDomain: "‰Ω†ÁöÑ authDomain",
      projectId: "‰Ω†ÁöÑ projectId",
      storageBucket: "‰Ω†ÁöÑ storageBucket",
      messagingSenderId: "‰Ω†ÁöÑ messagingSenderId",
      appId: "‰Ω†ÁöÑ appId"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const adminUID = "MT9pIgLkiadS3WbsLeui8zR3umd2"; // ‚úÖ ÁÆ°ÁêÜÂëò UID

    onAuthStateChanged(auth, async (user) => {
      const output = document.getElementById("output");

      if (!user || user.uid !== adminUID) {
        output.innerText = "‚ùå Access denied. You must be logged in as admin.";
        return;
      }

      output.innerText = "üîç Running script to fix product_id fields...";

      try {
        const querySnapshot = await getDocs(collection(db, "products"));
        let updated = 0;

        for (const docSnap of querySnapshot.docs) {
          const data = docSnap.data();
          if (!data.product_id || data.product_id !== docSnap.id) {
            const productRef = doc(db, "products", docSnap.id);
            await updateDoc(productRef, { product_id: docSnap.id });
            updated++;
          }
        }

        output.innerText = `‚úÖ Completed. Updated ${updated} product(s) with missing or incorrect product_id field.`;

      } catch (e) {
        console.error("‚ùå Error updating product_id:", e);
        output.innerText = "‚ùå Failed to update product IDs. See console for details.";
      }
    });
  </script>
</head>
<body style="font-family: sans-serif; padding: 2rem;">
  <h2>üõ† Fix Product IDs Tool</h2>
  <p id="output">Authenticating...</p>
</body>
</html>
